---
description:
created: 2025-11-21
modified: 2025-11-27
type: Notes
noteType: experience
source:
title: 网络分析
aliases:
memo: 社区发现，有调节的网络分析，时间...
createDate: 2025-11-21 09:02
modifyDate: 2025-11-27 23:27
tags:
  - update
  - 统计方法
cssclasses:
---

### 1. 基本概念

从名字上看，我们可以简单地知道网络分析 (Network Analysis, NA) 就是将不同的变量转化成图形中的节点 (Node)。在这个网络图形中，所有的节点之间相互连接，节点之间的连接用连线 (edges or path) 表示，节点间的连接强度越强，则连线或路径就越宽。这种连线可以是变量之间的相关、偏相关、或有向回归系数 [^1]。

然而事实上，如果我们在 [[结构方程模型]] 里多拉一点关系，是不是也是个“网络”？这就涉及到两种方法的核心。

1. 核心方法取向不同：虽然似乎可以拉很多相关，但这违背了 SEM 的使命。SEM 的核心就是靠潜变量来描述观察变量之间的关系，显变量的变异主要由潜在变量解释。因此，SEM 将模型分为测量模型和结构模型的层级关系。**这无法反映观察变量之间的直接互动**。相比于 SEM，NA 则直接讨论观察变量之间的关系。
2. 路径图 vs. 网络：除去测量模型，SEM 主要使用结构模型 (路径图) 来反映变量之间的关系，NA 则使用节点网络。两者最大的不同就是，路径图是研究者根据理论预设的，而节点网络类似于 [[因子分析#2. 探索性因子分析|EFA]]，但探索的是多个观察变量的关系，这能够帮助我们发现使用 SEM 时发现不了的关系，同时也导致两种方法得出结果的评价标准不同，SEM 主要探讨模型拟合度，NA 主要探讨模型稳定性。
- 两者共同的优点：相比于传统统计方法，均可以同时讨论多个变量之间的多种关系。

#### 1.1. 节点与边

网络分析的核心就是分析节点之间的关系，因此其网络的**基本结构**主要包括节点 (Node) 和边 (Edge)。由于 NA 的发展历史 [^2]，节点 (包括边) 的设定有很多的跨度，从一开始存在的实体 (e.g., 城市/某个人&社会关系)[^3] 到精神障碍的症状 (e.g., 抑郁症的 “情绪低落”“睡眠障碍”“注意力不集中”)，再到更“潜变量”的概念 [^4] (e.g., 抑郁 (分数))。目前，我们主要讨论变量网络 [^1]，而非社会网络 [^5]。

- 节点 (Node)：每个节点代表一个变量；
- 边 (Edge)：两个变量之间的关系，包括相关系数、协方差 [^6]、偏相关系数 (使用较多) [^7]、回归系数等 [^8]。在网络分析图中，边主要有权重 (Weight)、符号 (Sign) 以及指向性 (Direction) 三个特征 [^3]。
	1. 权重：指边线的粗细程度，边线越粗，表示关系越密切。
	2. 符号：指节点之间的边线颜色，代表节点之间关系的性质。一般来说，绿色或者蓝色边线表示正向关系，红色或表示负向关系。
	3. 指向性：是一种用于描述网络中边线是否具有因果关系的指标。如果节点之间具有因果关系，则在网络图中用边线的箭头表示所连接的节点存在因果关系。一般来说，被指向的节点为结果，则指向的节点为原因。

在一个网络中，大部分节点都会与其他节点连接并形成边。根据边属性的组合 (e.g., 权重、符号、指向性)，网络中会出现各种不同种类的结构，比如密集聚集的节点群，即子图 (subgraph)。当然也会有一些节点没有和其他节点连接，形成孤立节点 (Isolated Node)。因此，分析不同网络间的结构相似性和差异也是网络分析的一大功能 [^1]。

#### 1.2. 网络估计

然而，并不是所有网络中的边都具有权重和指向性，这会进一步导致形成的矩阵网络不同 (是的，和 SEM 一样，都是构建矩阵)。一般，我们会根据变量的类型来采用不同的模型进行**网络估计** [^9] [^10]。

1. 相关矩阵网络 (Correlation networks)：是一种不具有指向性的加权矩阵网络结构，仅计算变量间的简单相关 (如皮尔逊相关)，无法区分直接和间接关系，容易包含大量虚假相关。
2. 偏相关网络 (Partial Correlation Network)：是一种无向网络模型，只保留节点之间的直接连接，通过过滤掉由其他变量介导的间接关联减少了虚假相关，又称配对马尔可夫随机场 (Pairwise Markov Random Field, PMRF)，根据变量类型会使用不同的 PMRF 模型。
	- 连续变量：高斯图模型 (Gaussian Graphical Model, GGM)，又称为高斯随机场 (Gaussian Random Field)、浓缩图 (Concentration Graph) 以及偏相关网络 (Partial Correlation Network)。
	- 二分变量：伊辛模型 (Ising model)。该模型为一种多元逻辑回归模型，模型中的边线所代表的是某个节点能够预测其他节点的程度。
	- 既包含连续又包含二分变量：混合图模型 (Mixed graphical models, MGM)。

由于心理学数据常存在多重共线性，需通过正则化方法 [^11] (e.g., L1 正则化) 控制虚假连接，确保网络的稀疏性和可靠性，因此引入了正则化偏相关网络 (Regularized Partial Correlation Network)[^9]。该种网络常用于处理变量数量多于样本量的情况，常见的有 GLASSO 网络 (Graphical Least Absolute Shrinkage and Selection Operator, GLASSO)。

- GLASSO 网络主要采用 LASSO 算法 (the least absolute shrinkage and selection operator, LASSO)，通过强制让回归系数的绝对值之和小于某固定值，也就是强制一些回归系数为 0，有效地选择了不包括这些回归系数对应的协变量的更简洁模型。适用于单一网络估计以及一组网络估计之间的对比 (例如包含所有连接网络 vs 全部连接剔除后的网络)。

> [!note]- GLASSO 网络的核心思想 [^9] [^12] [^3]
> GLASSO 网络即图像化的 LASSO，其核心是构建一个稀疏的逆协方差矩阵 (也称为精度矩阵)，这个矩阵可以表示变量之间的直接关系，而非间接相关。通过在协方差矩阵的逆上引入 L1 惩罚项 (Lasso 算法)，促使非重要的连接 (即精度矩阵中的元素) 趋于零，从而实现网络的稀疏化；
>
> LASSO 算法主要通过设置调谐 (调优) 参数/惩罚系数 $\lambda$ 来控制减少虚假变量的程度：需要适当把握 $\lambda$ 的大小 (值偏低时，剔除的连接较少，仍存在较多虚假连接；值偏高时，剔除的连接较多，真实连接可能被一起剔除)。

为了选择最佳模型，研究者们对 LASSO 算法进一步加强，提出了基于 EBIC (扩展贝叶斯信息准则, Extended Bayesian Information Criterion, EBIC) 的 LASSO 算法 [^12] [^9]。该改进算法通过将 EBIC 最小化，在模型选择过程中考虑到了模型的复杂度和拟合优度。由于能够将虚假连接和真实连接区分，且不对虚假连接进行估计，因此更能够发现真实连接的网络模型。

- 但这种算法的敏感性较多变，和真实网络结构和样本量有关。例如，当真实网络存在很多连接或者特定某些节点存在很多连接，敏感性会减弱。使用的超参数 $\gamma$ 一般设置为 0.5。

#### 1.3. 网络推断分析

使用网络分析两大优点就是我们能够知道所有变量中哪一种变量更为重要，并且能够清晰地知道网络中变量的关系结构。为了达成这两大优点，需要进行相应的**网络推断分析** [^3]。

- 局部推断：对网络中的节点或者边线进行的统计分析，e.g., 节点的中心指标以及社区检测 (Community detection，或称为社区发现)。
- 全局推断：对网络结构整体进行分析，e.g., 小世界现象 (Small world theory) 和密度 (Density)，主要应用于具有权重的网络和马尔可夫随机场 (偏相关网络)。

##### 1.3.1. 局部推断

> 假设我们有一个由 $p$ 个节 (如症状) 组成的无向网络，邻接矩阵为 $W=[w_{ij}​]$，其中 $w_{ij}​$ 表示节点 $i$ 和 $j$ 之间的边权重 (通常来自正则化偏相关或回归系数)。

**中心度/中心性** (Centrality) ，是评估节点在网络结构中核心程度的量化指标，用于衡量节点在网络里的重要性，主要包含三种指标，其含义由名称易得 [^10] [^13]。
1. **强度** (Strength) / 度中心性 (Degree Centrality)：指与某节点相关的所有连接的加权值总和。强度越大，越是处于网络中心的位置，对于网络整体而言重要性也就越高，可以用于强调某一节点单独的价值。公式中 $j \ne i$ 指的是求和中不存在 $i \rightarrow i$ 的边权重 (要注意的是，度中心性只适用于二分网络，即边权重为 0 或 1，此时“度”指的是边的数量)。 $$S_i=\sum^p_{j\ne i} \left | w_{ij}\right |$$
2. 紧密中性度 (Closeness) / **接近中心性** (Closeness Centrality)：指一个节点到所有其他节点的最短路径长度的倒数。路径长度越短，紧密度越大，说明该节点距离其他节点都更近，越位于中心位置。公式中，$d_{ij}$ 指的是节点 $i$ 到节点 $j$ 的最短路径长度 (即两节点间最少连接数/权重最小路径)，$p-1$ 是归一化因子 [^8]。$C_i> 0.6$ 时较高；$C_i > 0.7$ 时很高。Closeness 对网络变化敏感，若 bootstrap 不稳定 ($CS < 0.5$) 慎用，需结合稳定性看；若网络不连通 (有孤立子图)，需使用修正版本 (如 harmonic closeness)。$$C_{i}=\frac{p-1}{\sum_{j \ne i}d_{ij}}$$
3. 中介中性度 (Betweenness) / **中介中心性** (Betweenness Centrality)：指一个节点位于网络中两两相连接的节点的最短路径程度。中介中心性越高，节点越能控制其他节点间的信息 / 影响传递。公式中，$\sigma_{st}$ 指的是节点 $s$ 到 $t$ 的所有最短路径的数量，$\sigma_{st}(i)$ 指的是节点 $s$ 到 $t$ 的最短路径中经过节点 $i$ 的数量。$B_i \approx 0$ 则为边缘角色；$B_i > 0.2$ 则为较重要；$B_i > 0.4$ 则为非常关键。注意，要特别关注那些 Strength 不高但 Betweenness 很高的节点。$$B_{i}=\sum^p_{s \ne i \ne t}\frac{\sigma_{st}(i)}{\sigma_{st}}$$

除了中心性指标，我们还需要衡量每个节点的**可预测性** (Predictability)，即一个节点能够被网络中其他所有节点联合预测的程度。通常用决定系数 $R^2$ 表示，常用于高斯图模型。在该模型中，每个节点 $X_i$ 被建模为其他所有节点的线性组合。公式中，$\beta_i$ 为回归系数，与边权重相关；$\varepsilon_i$ 为误差项，即无法被网络内其他节点解释的部分。当 $R^2 >0.5$ 时表示高可预测性；当 $R^2 <0.3$ 时表示低可预测性。要注意的是，虽然 $R^2$ 隐含了一定的方向信息，但是不能证明因果。 $$X_i=\beta_0+\sum_{j \ne i}\beta_j X_j + \varepsilon_i \ , \ Predictability = R^2=1-\frac{Var(\varepsilon_i)}{Var(X_i)}$$

当然，还有别的指标，但是适用于特定的网络矩阵。

1. 边权重 (Edge Weight) —— 基于高斯图模型 (GGM)：反映了控制其他变量后，两个节点之间连接的统计关联强度。在 EBICglasso 方法中，边权重来自稀疏逆协方差矩阵。公式中 $\Omega = \sum^{-1}$ 指的是数据协方差矩阵 $\sum$ 的逆矩阵 (精度矩阵)，$\Omega_{ij}$ 指的是精度矩阵中第 $i,j$ 元素。 $$w_{ij}=-\frac{\Omega_{ij}}{\sqrt{\Omega_{ii}\Omega_{jj}}}\ \ for \ i\ne j$$
2. **预期影响** (Expected Influence, EI) —— 用于有向网络：从一个节点出发的所有边的加权和 (即所有指定关系的相关系数之和，正负相抵消，如果取绝对值就算的是强度中心性了)，适用于时间序列或定向模型 (e.g., VAR, IsingFit)，反映了某个节点是更多影响其他节点还是更多被其他节点影响。当 $EI_I^+ > EI_I^-$ 时，该节点更多是“起因”；当 $EI_I^+ < EI_I^-$ 时，该节点更多是“结果”。$$EI_I^+=\sum_{j \ne i}w_{i \rightarrow j} \ ,\ EI_I^-=\sum_{j \ne i}w_{j \rightarrow i}$$

> [!note]- $EI1$ 和 $EI2$ [^14]
> 作为预期影响的下级概念，预期影响的 `one-step[EI1]` 表示给定节点对其直接相邻节点的影响程度，预期影响的 `two-step[EI2]` 则概括了一个节点在距离该节点最远两条边上的直接和间接影响程度。
>
> 在进行 [[#6. 桥梁分析|桥梁分析]] 时会遇到，可以在中心性指标里选择进行分析，一般论文中会汇报 $EI1$。

##### 1.3.2. 全局推断

随后，我们就需要判断整个网络的整体结构特征，如下指标可以用于比较不同群体或时间点的网络差异。

1. 网络密度 (Network Density)：即 $\frac{实际存在的边数}{所有可能的边数}$(即连接比例)，反映系统整体的整合程度。受正则化参数影响，不宜跨研究比较。公式中，$L$ 为实际存在的非零边数，$L_{max}=\frac{p(p-1)}{2}$ 为理论存在的最大边数。 $D< 0.2$ 为稀疏；$0.2 \sim 0.5$ 为中等；$D> 0.5$ 为密集。注意，受正则化参数影响，不宜跨研究比较。$$D=\frac{L}{L_{max}}=\frac{L}{\binom{p}{2}}=\frac{2L}{p(p-1)}$$
2. 聚类系数 (Clustering Coefficient, CC)：反映网络是否存在模块化结构，即局部抱团程度。公式中，$k_i$ 为节点 $i$ 的度 (连接数)，$e_i$ 为其邻居之间的实际连接数。$CC > 0.4$ 时为较高聚类。$$\begin{align} &局部：CC_{i}=\frac{节点 \ i \ 的邻居之间实际存在的边数}{最大可能边数}=\frac{2e_i}{k_i(k_i-1)}\\ &全局：CC=\frac{1}{p}\sum^p_{i=1}CC_i\end{align}$$
3. 平均最短路径长度 (Average Shortest Path Length)：即任意两个节点之间需要经过的最少边数的平均值，衡量信息在整个网络中传播的效率。公式中，$d_{ij}$ 为节点 $i$ 到 $j$ 的最短路径长度。$L< 2.0$ 为传播极快，可以结合 CC 判断是否为“小世界网络”。$$L=\frac{1}{p(p-1)}\sum_{i \ne j}{d_{ij}}$$
4. 小世界性 (Small-Worldness, $\sigma$)：即真实网络相对于随机网络的聚类与路径优势比，“高聚类 + 短路径”符合小世界特性，即信息高效传播且局部聚集。公式中，$CC_{rand}$ 指的是具有相同节点数和边数的随机网络的聚类系数，$L_{rand}$ 为同上随机网络的平均路径长度，一般通过模拟生成多个随机网络取均值。$\sigma > 1$ 时具有小世界性；$\sigma \approx 1$ 时接近随机网络。$$\sigma=\frac{CC/CC_{rand}}{L/L_{rand}}$$
5. **中心性稳定性系数** (CS-coefficient)：即原始中心性指数与基于样本子集网络的中心性指数之间的相关性以 95% 的概率保持在 0.7 以上时，可以去除的最大样本比例 [^12]。通过 bootstrap 方法评估中心性排序的稳定性/可靠性。公式中，$\tau$ 为原始排序与每次抽样排序的肯德尔相关系数。$CS$ 即为这些相关系数的下侧 5% 分位数。$CS > 0.5$ 为可接受；$CS > 0.7$ 为良好；$CS > 0.9$ 为优秀；若 $CS < 0.25$ 则意味着中心性结果不可信，不能下结论。$$CS=\tau_{lower5\%}$$
6. 边稳定性系数 (Edge Stability, corStability)：边权重在重复抽样中的稳定性，检验网络结构本身是否稳定。公式中，$w_b$ 为第 $b$ 次 bootstrap 抽样的边权重向量，$w_{full}$ 为原始全样本的边权重，$corr$ 为每次 bootstrap 抽样得到的网络与原始网络之间的边权重皮尔逊相关系数，$corStability$ 即为这些相关系数的中位数。$corStability > 0.25$ 为基本稳定；$corStability> 0.5$ 为良好；$corStability> 0.7$ 为非常稳定。$$corStability = median(corr(w_b,\ w_{full}))$$

#### 1.4. 网络结构的准确性分析

与传统统计分析方法类似，网络分析的准确性同样受到样本量的影响 [^3]。因此，我们需要使用 Bootstrap 法对估计结果 (主要是边权重和中心性) 进行验证分析，具体包括三个方面 [^10] (如下内容会与 [[#1.3 网络推断分析]] 的内容有所重叠)：

1. 每条边的稳定性：Edge Weight Accuracy (边权重的 bootstrap 95% 置信区间)；
2. 中心性指标的稳定性：Centrality Stability (CS-coefficient)；
3. 检验节点与节点或者边线与边线之间的差异。

如何计算**边权重的 bootstrap 95% 置信区间**？我们需要使用非参数 Bootstrap (实际上我们采用 non-parametric bootstrap 其中的一种，即 case-dropping bootstrap) 进行估计，来检验边权重的变异性。

1. 对样本库进行 1000 次重复抽样，使用 Bootstrap 法需要的原始样本约 20-30 个 [^10]；
2. 每次都重新估计网络，并得到每条边权重的经验分布，进而计算 95% 置信区间；

由于边权重就是相关系数，其对应零假设为 $y$ 和 $x$ 之间无相关，即相关系数为 0，因此如果置信区间过 0 点，则意味着“$y$ 和 $x$ 之间无关系”是可能的，即无法拒绝零假设，所以两节点的关系不稳定存在。

如何计算中心性指标的稳定性？我们需要使用 case-dropping bootstrap + 肯德尔相关系数 ($Kendall’s \ \tau$)[^15] 进行估计：

1. 每次只取原始样本的一定比例 (如 70%)，重复 1000 次，每次都重新估计网络；
2. 计算每次抽样的中心性排序与完整样本排序的相关性；
3. 取下侧 5% 分位数作为 **CS-coefficient** (Centrality Stability Coefficient)。

通常情况下，当 $CS<0.25$ 时，表明中心性结果不稳定；当 $CS>0.5$ 时，我们就可以接受中心性结果了；当 $CS>0.75$ 时，表明中心性结果非常稳定。

最后，我们就要探讨“在同一网络中，检验节点之间，边线之间，是否存在显著差异”？即**边权重和中心指标上的差异检验**。如果某个节点的稳定性显著高于其他节点，则说明该节点的强度具有稳定性。主要通过基于非参数自助法 (也叫重抽样，即 bootstrap) 的差异检验 (bootstrapped difference test)。如果做了多个成对比较 (如所有节点两两比)，应使用 FDR 或 Bonferroni 校正 $p/CIs$。

1. 每次只取原始样本的一定比例 (如 70%)，重复 1000 次；
2. 每次都重新估计网络，计算节点之间或者边权重之间的差值，得到了差值分布，进而得到了 95% 置信区间。

### 2. 网络间比较

除了在单个网络中找最重要的节点，我们还会根据某些变量进行分组，然后比较多个拥有相同节点的网络的结构，包括检验两个网络之间的差异以及中心性指标的关联 [^3]。

#### 2.1. 网络比较分析 (横断)

如何比较不同网络之间的结构差异呢？主要采用**置换检测** (Permutation testing) 来比较不同网络结构的不变性，即**网络比较分析** (Network Comparison Test, NCT)。要注意的是，该检验只适用于二分数据和连续数据，不能适用混合模型。NCT 既可以用来研究跨时间的变化，也可以研究跨样本的变化。置换检测主要关注三个方面：

1. 全局强度 (global strength) 的不变性：假设网络中所有边的强度之和 (即网络密度) 在不同子样本中保持一致，探讨了“整体上谁的网络更密集”；
2. 网路结构 (Network Structure) 的不变性：假设网络结构为一个整体，而且这一结构在不同子样本中保持不变，探讨了“网络‘形状’是否不同”，即两组之间的整体拓扑模式 (topological pattern) 有没有系统性差异；
3. 边线连接强度 (edge strength) 的不变性：检验网络结构中的某一特定边强度在子样本中是否出现差异，探讨了“具体哪条连接变了”。

NCT 方法的零假设为 —— 无论如何调换个体的顺序网络都保持不变。因此在实际操作过程中我们主要将两组的数据混合在一起，随机分成两组并计算差异。其具体步骤如下：

1. 计算真实差异：先在原始数据上分别估计两组的网络，随后计算它们之间的某种“距离”。比如，公式中 $W_A,\ W_B$ 为两组的边权重矩阵。差异越大，说明网络越不相似 (整体网络结构差异)。 $$D_{real}=\left \| W_A - W_B  \right \|_F$$
2. 构建零分布 (Null Distribution)：把所有被试的数据混在一起，随机重新分配“组别标签”(比如随机选出 50 人当“A”，其余为“B”)，在这个完全随机分组的数据上，重新估计两个网络并计算两者的差异 $D_{perm}$，重复这个过程 1000 次后就可以得到 $D_{perm}$ 的分布，即零分布。
3. 查看 $D_{real}$ 在零分布的位置，如果 $D_{real}$​ 落在右边尾巴上 (e.g., 超过 95% 的随机值)，说明它极不可能是偶然产生的，即拒绝零假设。其 $p$ 值为在 1000 次中 $D_{perm}​ \ge D_{real}$ 的次数，e.g., 只有 30 次 → $p = 0.03 < 0.05$。

最后会得到三个值：

1. **全局强度差异**：$\left | \sum{W_A} - \sum{W_B} \right |$，其中 $W_A$ 为 $A$ 网络的一条边权重的绝对值；
2. **个别边差异**：$\left \| w_{ij}^{(A)} - w_{ij}^{(B)} \right \|$，其中 $w_{ij}^{(A)}$ 为 $A$ 网络中节点 $i$ 与节点 $j$ 之间的边权重；
3. 整体网络结构差异：使用 **Frobenius 范数**衡量两个网络矩阵之间的“距离”，即所有边差异的平方和开根号，是综合性的拓扑结构比较。$$D_{F}=\left \| W_A - W_B  \right \|_F=\sqrt{\sum_{i \ne j}(w_{ij}^{(A)} - w_{ij}^{(B)})^2}$$

#### 2.2. paired-NCT (面板)

基于置换检测的 NCT 主要用于多组比较 (e.g., 男性 vs.女性；高水平 vs.低水平)，所有个体之间相互独立，所以每个被试数据的标签被打乱也没关系。然而，对于纵向数据或者多次测量得到的数据，两组之间具有一定的配对关系 (e.g., 一个人的前后测)。如果使用先前的“打乱后重组”，则可能会导致“A 的前测和 B 的后测对比”的类似情况，进而更容易表现出显著差异。因此，我们需要使用**配对的置换检测** (paired permutation test)，即 paired-NCT。

1. 计算真实差异：同 [[#2.1. 网络比较分析 (横断)|NCT]]；
2. 构建零分布：对于每个被试，以 50% 概率交换或不交换其 T1 和 T2 标签，随后重新定义新 T1 组和新 T2 组。在这个随机分组的数据上，重新估计两个网络并计算两者的差异。重复 1000 次后即可得到某个指标的零分布；
3. 查看真实差异在零分布的位置：同 [[#2.1. 网络比较分析 (横断)|NCT]]。

> [!note]- 适用于密集纵向数据的方法
> paired-NCT 只适用且最适用于两个时间点的研究，因此如果需要分析密集纵向型的数据还需要采用其他的方法。
> 1. Graphical Vector Autoregression (gVAR)：多个时间点 ($\ge 5$ 次)，可建模动态反馈、滞后效应；
> 2. Group-Impulse Response Function (GIRF)：想知道“一个症状波动后，其他如何响应”	提供因果方向线索；
> 3. Multilevel Vector Autoregression (mlVAR)：多被试 + 多时间点	分离个体内与个体间效应。

### 3. 使用 R 进行 NA (单个网络)

#### 3.1. 资源与基本步骤

> [!example]- 可用于练习的数据
> 使用 [Applying an attitude network approach to consumer behaviour towards plastic](https://www.sciencedirect.com/science/article/pii/S0272494419308783) 研究中 study 2 的数据学习网络分析，数据文件见 [Data](https://osf.io/ujznv/overview)。
> - Zwicker, M. V., Nohlen, H. U., Dalege, J., Gruter, G.-J. M., & van Harreveld, F. (2020). Applying an attitude network approach to consumer behaviour towards plastic. _Journal of Environmental Psychology_, _69_, 101433. [https://doi.org/10.1016/j.jenvp.2020.101433](https://doi.org/10.1016/j.jenvp.2020.101433)

关于使用 R 来进行 NA，许多教程中的代码都有所不同。比如虽然基本上就用 `qgraph` `bootnet` `NetworkComparisonTest` 这几个包，但是每个人在网络估计、画图时用的包都不太相同。

1. Zwicker et al. (2020) 等人提供的代码中主要先用 `cor()` 函数来求相关，然后再使用 `qgraph` 包来进行网络估计、求中心性指标 (`centralityPlot()` 函数) 和绘图 (`qgraph()` 函数) [^16]。类似的，在三个教程中 [^3] [^10] [^17]，作者均首先使用 `cor_auto()` 函数来自动建立合适的相关矩阵，然后再使用 `qgraph` 包来进行网络估计和绘图 。
2. 然而在知乎的两个教程中 [^18] [^19]，作者主要使用 `bootnet` 包里的 `estimateNetwork()` 函数进行网络估计，然后使用 `plot()` 函数绘图。

> [!note]- estimateNetwork() vs. qgraph()
> `cor_auto()` 和 `qgraph()` 均为 graph 包中的函数，qgraph() 函数会根据提供的相关矩阵绘制图形，因此需要提前使用 cor_auto() 来计算出相关矩阵。如果仅提供相关矩阵而不做额外设置，它将简单地显示所有节点和边，不进行任何稀疏处理 (即不会尝试去除不重要的边以简化网络)。而 `estimateNetwork()` 为 bootnet 包中的函数，默认使用 EBICglasso 方法进行边的选择 —— 一种基于 LASSO 正则化的稀疏化技术，用于选择最可能的网络结构。两者的区别如下：
> 1. **网络估计 vs 网络可视化**：`estimateNetwork()` 主要用于估计网络模型本身，包括边的选择；而 `qgraph()` 更多的是一个可视化工具有时也用于直接绘制网络，但需要输入已经准备好的关联矩阵或权重矩阵。
> 2. **稀疏化处理**：`estimateNetwork()` 默认采用 EBICglasso 方法对网络进行稀疏化处理，以减少噪音并提高网络解释性；而使用 `cor_auto()` 和 `qgraph()` 组合时，除非手动指定，否则不会自动应用这样的稀疏化过程。
> 3. **灵活性与控制**：使用 `estimateNetwork()` 可以更容易地应用不同的网络估计方法和参数调整；而在 `qgraph()` 中，用户需要更多手动步骤来实现相似的效果。

综合起来，可以先使用 `estimateNetwork()` 来估计网络，然后使用 `plot()` 绘图 (因为在实际操作过程中，用 `qgraph` 的 glasso 正则化处理要求给予样本量大小，太麻烦了)。之后再使用 `bootnet()` 来检验稳定性并用 `plot()` 导出边权重的置信区间图、各项中心性指标随抽取样本的百分比变化、各个节点的中心性差异、边权重差异的图)。涉及的一些包如下，标注了可能用到的对应函数。

- `qgraph` 包：用于估计和可视化网络 (特别是基于偏相关或正则化精度矩阵)，支持 LASSO 正则化；
	- `cor_auto()` 函数：用于自动计算合适的相关矩阵；
	- `qgraph()` 函数：用于网络估计和输出网络图；
	- `centrality_auto()` 函数：输出中心性指标；
	- `centralityTable()` 函数：输出中心性指标的细节信息；
	- `centralityPlot()` 函数：输出中心性指标的图。
- `bootnet` 包：对网络结构进行稳定性评估、边权重的置信区间估计、案例剔除分析 (case-dropping bootstrap) 等。
	- `estimateNetwork()` 函数：进行网络估计，默认使用 EBICglasso 方法进行边的选择；
	- `bootnet()` 函数：评估边的稳定性、中心性指标的稳定性；
	- `differenceTest()` 函数：检验同一网络中的两个节点之间、两个边权重之间的差异。

实际分析步骤实际上已经在上文提到了，不过这里更系统的整理一下。我们在正式进行 NA 前需要检查数据的一些情况，包括不限于缺失值的处理、正态性检验，相关数据可以进行转换的要转换。在做完这些后，我们就可以正式开始 NA 了。

1. [[#1.2. 网络估计|网络估计]]：这一步我们需要使用先使用 `estimateNetwork()` 计算得到相应的相关矩阵，随后需要设置等会输出网络图需要的参数 (group, labels, nodenames)，最后使用 `plot()` 输出网络图。
2. [[#1.3.1. 局部推断|网络推断分析]]：主要是局部推断，即各个节点的中心性指标 (强度、中介度、紧密度)、预期影响 [^20]。使用 `centralityPlot()` 输出强度 (Strength)、中介度 (Betweenness)、紧密度 (Closeness)、预期影响 (ExpectedInfluence，此时输出的图中 $EI^+$ 和 $EI^-$ 抵消了 [^8]) 的折线图。可以使用 `centrality_auto` 或者 `centralityPlot()` 输出具体的值。
3. 网络结构的准确性分析 (稳定性/稳健性)：先使用 `estimateNetwork()` 再次估计网络，然后使用 `bootnet()` 进行非参 bootstrap，再使用 `plot()` 画对应指标的图 (各节点中心性的差异检验图、各边权重的差异检验图、带有置信区间的边权重图、各中心性指标的 [[#1.3.2. 全局推断|CS-coefficient]] 随抽样百分比变化的图)。

#### 3.2. 分析过程

> 采用 `psych` 包自带的内置数据集 bfi 进行练习 [^18]。

代码如下，要注意的地方主要是网络的估计以及 bootstrap 法检验稳定性。

1. 估计网络：
	1. 推荐使用 `estimateNetwork()` 而不是 `qgraph()`；
	2. 要提前分组，才能使用 theme 或者 palette 指定不同组的颜色；
	3. label 指的是图中每个节点显示的名称；nodenames 指的是图例显示的内容。
2. bootstrap 法：考虑到生成差异检验图时 (`plot(data,plot="difference")`) 只能使用完整的非参 bootstrap 得到的结果，且只有完整非参 bootstrap 得到的数据才能绘制 edge 的 95% 置信区间，因为如果使用 `bootnet(data, type = "case")` 进行 case-drop bootstrap 的话，最终生成的图只能是 edge 随着 case-drop 率的变化图。综上，一共要进行两次 bootstrap，一次不指定 type，即默认非参冲抽样；另一次指定 type=case，进行 case-drop bootstrap。

除了输出全部的差异检验图，还可以使用 `differenceTest()` 函数进行特定两个节点或者特定两个边的比较，此处在下方代码的末端。要注意的是，边是方向的，即“A3 -- A2”可能会找不到边，而“A2 -- A3”就能找到了。

```R
getwd()
setwd("C:/Users/admin/Desktop/暂存/001-留中/R 网络分析")
library(psych)
library(ggplot2)
library(bootnet)
library(qgraph)

#加载数据
df <- bfi[,1:25]

#提前对变量分组，复制了五遍
traits <- rep(c('Agreeableness',
                'Conscientiousness',
                'Extraversion',
                'Neuroticism',
                'Openness'),
              each = 5)

#提前给每个节点根据变量名命名
items <- c(
  "Am indifferent to the feelings of others.",
  "Inquire about others' well-being.",
  "Know how to comfort others.",
  "Love children.",
  "Make people feel at ease.",
  "Am exacting in my work.",
  "Continue until everything is perfect.",
  "Do things according to a plan.",
  "Do things in a half-way manner.",
  "Waste my time.",
  "Don't talk a lot.",
  "Find it difficult to approach others.",
  "Know how to captivate people.",
  "Make friends easily.",
  "Take charge.",
  "Get angry easily.",
  "Get irritated easily.",
  "Have frequent mood swings.",
  "Often feel blue.",
  "Panic easily.",
  "Am full of ideas.",
  "Avoid difficult reading material.",
  "Carry the conversation to a higher level.",
  "Spend time reflecting on things.",
  "Will not probe deeply into a subject.")

# 使用cor_auto计算相关矩阵，并使用qgraph生成网络图
## 在使用glasso法时需要给予样本量的数据，但是cor_auto法默认使用pairwise deletion处理缺失值，所以我们最好提前删掉带有缺失值的数据行
df_clean <- na.omit(df) # 删除df中带有缺失值的数据行
R <- cor_auto(df_clean) # 求新数据的相关矩阵
n <- nrow(df_clean) # 得到新数据的样本量
network_qgraph <- qgraph(R,groups = traits,graph="glasso",sampleSize=n,
                         layout="spring", minimum=0.1,cut=0.4,vsize=6,
                         legend=TRUE,borders=TRUE,palette="colorblind",
                         title="NA",legend.cex=0.25,label.cex=1,
                         height=5,width=5,nodeNames=items, # labels=Labels 标签即圆圈里显示的东西
                         mar=c(4,1,2,2)) # nodeNames则是图例里的东西


#拟合网络模型
network <- estimateNetwork(df,
                           default = "EBICglasso", #使用lasso
                           corMethod = "spearman") #使用spearman

#运行一下network可以看一下小摘要
network

# 绘制网络图
plot(network, 
     layout = "spring",#布局
     groups = traits, #分组
     label.cex = 0.7, #调整节点中标签的字体大小
     label.color = 'black', #节点中标签的颜色
     negDashed = T, #负相关的边为虚线
     legend=T,
     nodeNames = items, #图例中的节点标签名
     legend.cex = 0.27, #图例中节点的标签字体大小
     legend.mode = 'style2', #图例的风格，默认是'style1'
)

# 评估中心性并绘图
centralityPlot(network, 
               include = "all", #根据ExpectedInfluence的结果排序
               orderBy = "ExpectedInfluence", scale = c("z-scores")) # 显示Z分数
centrality_auto(network)

# 评估边的稳定性(95%置信区间)
## 注意：如果指定case-drop bootstrap，那么生成的edge图只能是随着drop-case数量变化的图
bootnet_nonpar <- bootnet(network, 
                          nBoots = 1000, #自助法1000次
                          nCores = 8) #通过计算机8核处理器运行
plot(bootnet_nonpar,
     labels = FALSE,
     order = "sample")

# 评估中心性指标的稳定性、边权重的稳定性(用于进行差异检验)
bootnet_case_dropping <- bootnet(network, 
                                 nBoots = 1000, #自助法1000次
                                 type = "case", # 采用case-drop 重抽样
                                 nCores = 8, #通过计算机8核处理器运行
                                 statistics = c('strength',
                                                'expectedInfluence',
                                                'betweenness',
                                                'closeness',"edge"))

## 注意：如果指定case-drop bootstrap，那么生成的edge图只能是随着drop-case数量变化的图
# plot(bootnet_case_dropping,c("edge"),
#      labels = FALSE,
#      order = "sample")

plot(bootnet_case_dropping, 'all')
corStability(bootnet_case_dropping) # 输出CS系数

# 节点和边权重的差异检验图，plot="difference"不支持指定case-drop的bootstrap法
plot(bootnet_nonpar,"strength",plot = "difference") # 指定生成差异图
plot(bootnet_nonpar,"edge",plot = "difference") # 指定生成差异图

# 指定两个节点进行差异检验
differenceTest(bootnet_nonpar, "C4", "E4", "strength")
# 指定两个边进行差异检验，要注意"A5--A3"是错误写法，不存在这条边
differenceTest(bootnet_nonpar,"A3--A5","A2--A4","edge")
```

#### 3.3. 输出解读

考虑到在实际研究中，似乎报告相关系数、CS 系数、显著性、中心性指标等即可，其他均可使用“图论”的方式讨论。所以我们实际要关注的输出信息并不多，对应上方示例代码。

1. 使用 `estimateNetwork()` 估计完网络后，输出一下网络矩阵，简单查看一下网络的相关信息，e.g., 一共多少条边，多少负边和多少正边。
2. 使用 `centrality_auto(network)` 输出中心性指标，会有 `$node.centrality` 和 `$ShortestPathLengths` 两个有用的表，分别列出了每个节点的中心性指标、每个 edge 的权重大小。
3. 使用 `corStability(bootnet_case_dropping)` 输出 CS 系数，会得到各个中心性指标的 CS 系数。

剩下的就看图吧，一共会输出张图。

1. 网络图：一般来说红色代表负向关系，绿色代表正向关系。越粗代表关联越强，越细代表关联越弱。
2. 中心性指标图：纵轴为 Z 分数 (如果你指定 `centralityPlot(data, scale = c("z-scores"))` 的话)，分数越高越表明该节点的中心性指标更高。
3. 边权重的 bootstrap 检验图：由于边权重其实为相关系数，所以横轴显示的是边权重的值，纵轴为每条边的名称。
4. 节点强度的差异检验图：图中分为黑色块和灰色块，黑色块代表对应两个节点之间存在显著差异，灰色块则相反。中间白色块中的值为每个节点的强度。
5. 边的差异检验图：同上。
6. 中心性指标随 case-drop 比例变化的折线图：一般我们认为当 case 越少时，网络越不稳定。纵轴为样本中心性指标与 bootstrap 的模拟样本中心性指标的相关性，即 CS 系数。

#### 3.4. 可预测性的计算和绘图

所谓可预测性就是该节点被其他相连节点解释的程度，采用决定系数 $R^2$ 表示。在大部分文章中，可预测性通常以节点的边框粗细表示。要想计算可预测性，需要使用 `mgm` 包先拟合回归模型，然后使用 `predict()` 函数进一步计算拟合优度 (`mgm()` 不会返回 $R^2$，但是会包含方程中的所有回归系数)。

代码如下，使用内置数据集 `depression` 进行练习 [^21]，其中要注意的就是 `mgm()` 函数的配置。

- `type = rep("g", p)`：type 指定每个变量的分布类型，`"g"` 即 Gaussian (高斯/连续变量)；`"c"` 即 Categorical (分类变量)；`"p"` 即 Poisson (计数变量)。我们使用 `p = ncol(network)` 得到了变量个数，所以 `rep("g", p)` 表示“所有 p 个变量都是连续的”。
- `level = rep(1, p)`：指定分类变量的类别数。对连续变量 ("g")，level 必须设为 1 (这是 mgm 的约定)。对分类变量 ("c")，比如有 3 个类别，就设为 3。
- `lambdaSel = "CV"`：lambda 是 L1 正则化 (Lasso) 的惩罚强度，控制网络稀疏性。"CV" 表示使用 k 折交叉验证 (Cross-Validation) 自动选择最优 lambda。其他选项如 "EBIC"(扩展贝叶斯信息准则) 也常用，但 CV 更注重预测准确性，这与 predictability 目标一致。
- `ruleReg = "OR"`：控制如何从正则化路径中确定最终的边 (即偏相关是否非零)。"OR" 表示只要在任意一个节点的回归中，某个系数被选中 (非零)，就保留这条边。另一个常见选项是 "AND"(要求两个方向都非零)，但 "OR" 更敏感，常用于探索性分析。
- `pbar = TRUE`：显示进度条。

在生成网络图时，采用 `plot(network, pie = pred_obj$error[,2]))` 来画节点的边框进度，这里设置 2 为最大值。

```R
getwd()
setwd("C:/Users/admin/Desktop/暂存/001-留中/R 网络分析")

library(networktools)
library(bootnet)
library(mgm)

################### 1. 计算可预测性 ###################
data <- depression # 用 depression 数据作为本教程的示例数据
network <- as.matrix(data) # mgm 函数需要使用矩阵数据
p<-ncol(network) # 用于指定数据框的列数
# mgm 在拟合模型后，会自动计算每个节点的 out-of-sample 预测准确性(通过留一法或交叉验证)。
fit_obj <- mgm(data = network, 
              type = rep("g", p),  # "g"表示高斯(连续)变量
              level = rep(1, p),   # 对于连续变量设为1
              lambdaSel = "CV",    # 使用交叉验证选择lambda
              ruleReg = "OR",      # 正则化规则
              pbar = TRUE)        # 打开进度条
# 利用已拟合的 mgm 模型，计算每个节点被其余所有节点预测时的拟合优度(虽然mgm算了但不会返回该值)。
pred_obj <- predict(object = fit_obj,
                    data = network,
                    errorCon = 'R2')
pred_obj$error # 可预测性计算结果


################### 2. 网络估计和生成图 ###################
groups<-list("PHQ-9 symptoms"=c(1:9)) # 指定组
Network <- estimateNetwork(data=network,
                           default = "EBICglasso",
                           tuning = 0.5,
                           corMethod="cor",#相关
                           corArgs=list(method="spearman",# spearman相关的估计更为稳健
                                        use="pairwise.complete.obs"))

plot_network <- plot(Network,
                     layout = "spring",
                     groups = groups,
                     label.cex = 1, #调整节点中标签的字体大小
                     label.color = 'black', # 调整节点中标签的字体颜色
                     negDashed = T, #负相关的边为虚线
                     legend=T,
                     #nodeNames = items, #图例中的节点标签名
                     legend.cex = 0.32,#图例的字体大小
                     legend.mode = 'style1',#图例的风格，默认是'style1'
                     pie = pred_obj$error[,2]) # 显示可预测性的环
```

### 4. 使用 R 进行 NCT

#### 4.1. 分析过程

如上文所述，NCT 主要用于 [[#2.1. 网络比较分析 (横断)|横断面数据]] 的两个网络之间的差异检验。在 R 中我们主要使用 `NetworkComparisonTest` 包实现横断面数据的网络比较，类似步骤同单个网络的 NA。但不同的是，只需要提供原始数据给该包就会自动完成网络估计 (默认使用 GGM + graphical LASSO)、置换检验并且比较网络结构和全局强度。

1. 数据处理：缺失值处理 (e.g., 删除带有缺失值的数据行)、正态性检验。如果数据均在同一文件中，需要进行分组并且赋值到不同变量中，至于是否要平衡样本量，可选；
2. 网络图对比：分别使用 `estimateNetwork()` 进行网络估计，并使用 qgraph 包中的 `averageLayout()` 让两个网络图的排版一致 (可以使用 `list(network1, network2)` 让输出的中心性指标图中同时出现两个网络的结果) [^22]。
3. 网络比较：直接使用 `NCT()` 进行网络比较，并使用 `print()` 打印结果。

对应代码如下，采用 `psych` 包的内置数据集 `bfi` 进行练习。在比较网络间边权重的不变性时，由于进行了多次两两比较，增加了二类错误发生的概率，因此需要进行 $p$ 矫正：`NCT(data1, data2, p.adjust.methods = "BH")`[^23]。

```R
getwd()
setwd("C:/Users/admin/Desktop/暂存/001-留中/R 网络分析/02_NCT_横截面/")


library(psych)
library(qgraph)
library(ggplot2)
library(bootnet)
library(NetworkComparisonTest)


data(package="psych") # 查看psych包的内置数据集
data(bfi, package = "psych") # 导入psych包的bfi数据集
table(bfi$gender, useNA = "ifany")
bfi_sel <- bfi[,1:26]


# 删除带有缺失值的数据行
bfi_clean <- na.omit(bfi_sel)
# 分组
males   <- bfi_clean[bfi_clean$gender == 1, 1:25]
females <- bfi_clean[bfi_clean$gender == 2, 1:25]
# 查看样本量
cat("Males:", nrow(males), "\n")
cat("Females:", nrow(females), "\n")
# (可选)平衡样本量
# set.seed(123)
# if (nrow(males) < nrow(females)) {
#   females <- females[sample(nrow(females), nrow(males)), ]
# } else {
#   males <- males[sample(nrow(males), nrow(females)), ]
# }


# 进行网络比较
nct_res <- NCT(
  data1 = males,data2 = females, it = 1000,
  binary.data=FALSE, paired = FALSE, # 数据是否是独立or配对的
  test.edges=TRUE, edges = "all", p.adjust.methods = "BH",
  progressbar = TRUE, test.centrality = TRUE, centrality = "strength"
)
print(nct_res)


# 分别估计网络
net_m <- estimateNetwork(males, default = "EBICglasso")
net_f <- estimateNetwork(females, default = "EBICglasso")
L <- averageLayout(net_f,net_m) # 将网络设置为统一格式用于比较

# 并排绘图
par(mfrow = c(1, 2))
plot(net_m, layout = L, title = "Male Network")
plot(net_f, layout = L, title = "Female Network")
par(mfrow = c(1, 1))
centralityPlot(list(net_m,net_f),
               include = c("Strength","Closeness"),
               orderBy = "Strength",scale = "z-scores")
```

#### 4.2. 输出解读

主要会输出三个不变性检验，依次为网络结构不变性检验、全局强度不变性检验、边权重不变性检验，当 $p<0.05$ 时，表示两个网络存在显著差异。该值会受到置换检验的影响，因此每次执行都会有变化，可以使用 `set.seed(随便啥数字)` 来保证得出相同结果。

> [!note]- 输出
>
> ```bash
> > nct_res <- NCT(
> +   data1 = males,data2 = females, it = 1000,
> +   binary.data=FALSE, paired = FALSE, # 数据是否是独立or配对的
> +   test.edges=TRUE, edges = "all",
> +   progressbar = TRUE, test.centrality = TRUE, centrality = "strength"
> + )
>   |=====================================================================================| 100%
> > print(nct_res)
> 
>  NETWORK INVARIANCE TEST 
>  Test statistic M: 
>  0.09936762 
>  p-value 0.6973027 
> 
>  GLOBAL STRENGTH INVARIANCE TEST 
>  Global strength per group:  10.50884 11.36907 
>  Test statistic S:  0.8602323 
>  p-value 0.6663337
> 
>  EDGE INVARIANCE TEST 
>     Var1 Var2     p-value Test statistic E
> 26    A1   A2 0.078921079       0.08280985
> 51    A1   A3 0.781218781       0.01167936
> 52    A2   A3 0.545454545       0.02512874
> 76    A1   A4 1.000000000       0.00000000
> 77    A2   A4 0.497502498       0.02972069
> 78    A3   A4 0.605394605       0.02175377
> 101   A1   A5 1.000000000       0.00000000
> 102   A2   A5 0.289710290       0.04541415
> 103   A3   A5 0.040959041       0.09202061
> 104   A4   A5 0.851148851       0.00717629
> 126   A1   C1 0.556443556       0.00691760
> 127   A2   C1 1.000000000       0.00000000
> 128   A3   C1 1.000000000       0.00000000
> 129   A4   C1 1.000000000       0.00000000
> 130   A5   C1 0.330669331       0.00443126
>  [ reached 'max' / getOption("max.print") -- omitted 50 rows ]
> 
>  CENTRALITY INVARIANCE TEST p-value
>     strength
> A1 0.3046953
> A2 0.4495504
> A3 0.5504496
> A4 0.9700300
> A5 0.8461538
> C1 0.7242757
> C2 0.6973027
> C3 0.2907093
> C4 0.6043956
> C5 0.7342657
> E1 0.9770230
> E2 0.5454545
> E3 0.6303696
> E4 0.9850150
> E5 0.8261738
> N1 0.1618382
> N2 0.1238761
> N3 0.3806194
> N4 0.2837163
> N5 0.4755245
> O1 0.8001998
> O2 0.1528472
> O3 0.2667333
> O4 0.7462537
> O5 0.5494505
> ```

### 5. 使用 R 进行 paired-NCT

实际上，在使用 `NCT()` 时可以指定是否使用配对置换检验，即 `NCT(data1, data2, paired = TRUE)`。

```
nct_res <- NCT(
  data1 = males,data2 = females, it = 1000,
  binary.data=FALSE, paired = TRUE, # 当为TRUE时，可用于分析配对数据
  test.edges=TRUE, edges = "all",
  progressbar = TRUE, test.centrality = TRUE, centrality = "strength"
)
print(nct_res)
```

### 6. 桥梁分析

#### 6.1. 基本概念

从上文我们已经知道，不仅可以使用 NA 探索单个网络内的情况 (e.g., 节点的重要性衡量、节点之间的比较、边权重之间的比较)，还可以对比一组网络之间的差异 (e.g., 拓扑结构的比较、中心性指标的比较、边权重的比较)。然而，在许多研究中，学者们还会关注另一类问题：心理特征 A 有哪几个方面作为关键节点将心理特征 A 与心理特征 B 联系在一起？具象化后其实就是单个网络内子集之间的桥接问题 [^24]。

- e.g., 在 抑郁症状 + 社会支持 的联合网络中，某个抑郁症状 (如“孤独感”) 如果与“社会支持”变量高度连接，它就是一个 bridge node。

桥梁分析 (Bridge Analysis) 由 Jones 等人 (2019) 在中心性指标的基础上提出 [^25]，其提出的桥梁中心性指标与中心性指标类似。但不同的是，桥梁中心性指标是基于节点分组，分析某一组 (A 组) 内某一节点 N1 与另一组 (B 组) 内所有节点的关系，而不计算 N1 与同组内其他节点的关联。因此，某一节点的桥中心性越高 (如 N1)，表示它可能是在网络中起到连接它所在组与其他组关联的作用，即 A 组的其他节点通过 N1 与其他组的节点产生联系，这样的节点被称作“桥梁节点”[^17] [^20]。

1. 桥强度 (Bridge Strength)：一个节点与其他子群所有节点的连接权重之和 (绝对值)；
2. 桥亲近度 (Bridge Closeness)：到其他子群节点的平均最短路径 (越小越“桥”)；
3. 桥中介度 (Bridge Betweenness)：作为其他子群节点间最短路径中介的频率；
4. 桥预期影响度 (bridge expected influence)：用于衡量某个节点对其他子系统 (社区) 的总体影响强度和方向，即一个节点仅对其所属社区之外的所有节点的边权重之和 (保留符号)。

#### 6.2. 使用 R 进行 NA 的桥梁分析

基本流程与在单一网络中计算中心性指标并进行准确性分析的步骤一样，只在一些参数上存在差异 [^26]。在进行桥梁分析时，主要采用 `networktools` 这个包的 `bridge()` 函数计算桥梁中心性指标。要注意的是，在进行 bootstrap 时 (即将桥梁节点单独分为一组) 一定要指定 `bootnet()` 的 `communities` 的值，否则会报错 (因为要用这个值来算 bridgeStrength 等指标)[^27]。

代码如下，使用 `psych` 包的内置数据集 `bfi` 进行练习。

```R
getwd()
setwd("C:/Users/admin/Desktop/暂存/001-留中/R 网络分析/03_NA_bridge analysis")

library(psych)
library(qgraph)
library(networktools) # 网络分析工具包，用于桥梁中心性分析
library(bootnet) # 网络自举分析工具，用于评估网络稳定性
library(ggplot2)


#################### 1. 数据准备 ####################
data(bfi, package = "psych")
bfi_clean <- na.omit(bfi[, 1:25]) #na.omit删除带有缺失值的行

# 按大五理论划分社区（每维度5题）
comm_labels <- c(
  rep("Agreeableness", 5),    # A1-A5
  rep("Conscientiousness", 5),# C1-C5
  rep("Extraversion", 5),     # E1-E5
  rep("Neuroticism", 5),      # N1-N5
  rep("Openness", 5)          # O1-O5
)
names(comm_labels) <- colnames(bfi_clean)

# 查看结构
head(bfi_clean)
table(comm_labels)


#################### 2. 网络估计 ####################
# 网络估计（使用 EBICglasso，默认 gamma = 0.5）
net_bfi <- estimateNetwork(
  bfi_clean,
  default = "EBICglasso",   # 使用 EBIC 调优的 graphical LASSO
  tuning = 0.5,             # EBIC 的 γ 参数：0=更稠密，1=更稀疏；0.5 是默认平衡点
  corMethod = "cor_auto"    # 自动处理有序变量（BFI 是 Likert，视为有序）
)
# 提取邻接矩阵（偏相关网络）
adj_mat <- net_bfi$graph
# 输出图
plot(net_bfi,layout = "spring", groups = comm_labels,
     label.cex = 0.7, label.color = 'black',
     legend=F,
     legend.cex = 0.45, # 图例的字体大小
     legend.mode = 'style1', # 图例的风格，默认是'style1'
     )


#################### 3. 输出桥梁指标 ####################
# 计算所有桥梁指标
bridge_centrality <- bridge(adj_mat,
  communities = comm_labels)
# 输出相关信息
print(bridge_centrality)
# 输出图
plot(bridge_centrality,order="value",zscore=T)
# 求桥接节点
bridge_Strength <- bridge_centrality$`Bridge Strength`
# 哪些节点的桥梁强度大于第80百分位数
top_bridges <- names(bridge_Strength[bridge_Strength>quantile(bridge_Strength,
                                                              probs=0.80,
                                                              na.rm=TRUE)])
print(top_bridges)


#################### 4. 绘制桥梁网络图 ####################
# 在绘制桥梁网络图之前，需要先给各个变量分组。
# 有两种方法，一种是求得这些桥梁节点所在列，按所在列分组；
# 另一种是直接把节点名给分组。
# 这里使用的是第一种方法：
bridge_num <- which(names(bridge_Strength) %in% top_bridges)
bridge_num # 确定桥接节点所在列
# 将桥接节点单独列为一类
groups_new<-list("agree"=c(1:5),"conscientious"=c(6:10),"extraversion"=c(11:12),
                 "neuroticism"=c(16:19),"openness"=c(21:23,25),"bridge nodes"=c(13:15,20,24))
plot_network <- plot(net_bfi,
                     layout = "spring",
                     groups = groups_new,
                     label.cex = 0.6, #调整节点中标签的字体大小
                     label.color = 'black', # 调整节点中标签的字体颜色
                     #   negDashed = T, #负相关的边为虚线
                     legend=F,
                     legend.cex = 0.45,#图例的字体大小
                     legend.mode = 'style1')#图例的风格，默认是'style1'


#################### 5. 网络结构的准确性检验 ####################
# 先进行非参bootstrap求边权重的置信区间/差异检验，而不指定特定子类case-drop bootstrap
boot_net <- bootnet(net_bfi,nBoots = 200,nCores = 8,
                    statistics = c("edge","bridgeStrength"),
                                   communities = groups_new)
plot(boot_net,labels=FALSE,order="sample") # 输出edge的图
plot(boot_net,"edge",plot = "difference") # 生成边的差异图
plot(boot_net,"bridgeStrength",plot = "difference") # 生成桥梁强度的差异图

# 进行case-drop bootstrap，计算CS系数
boot_casedrop_net <- bootnet(net_bfi,nBoots = 200,nCores = 8,
                             statistics = c("bridgeStrength"),
                             communities = groups_new,type = "case")
corStability(boot_casedrop_net)
plot(boot_casedrop_net,"bridgeStrength")
```

### 7. 待更新内容

还有其他很多类型的网络......[^28]

[^1]: [(变量)网络分析简介 - 知乎](https://zhuanlan.zhihu.com/p/377105983)
[^2]: [Network Analysis in the Social Sciences(社会科学中的网络分析)论文笔记整理_基于network的网络分析-CSDN博客](https://blog.csdn.net/weixin_52938961/article/details/132045678)
[^3]: 😽[网络分析第一部分_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1Le411F7ue/)
[^4]: 这个时候，NA 就继承了 [[结构方程模型#1. 基本内容|传统统计方法的缺点]] —— 打包题项分数得到“抑郁”变量时会损失一些数据。
[^5]: [一文读懂社会网络分析(SNA)理论、指标与应用 - 知乎](https://zhuanlan.zhihu.com/p/515343117)
[^6]: [协方差 vs. 相关系数](https://zhuanlan.zhihu.com/p/266161140)，相关系数是协方差的归一化 (normalization)，消除了两个变量量纲/变化幅度不同的影响。
[^7]: [偏相关_CSDN](https://blog.csdn.net/liuyuan_jq/article/details/52590396)，偏相关就是控制了第三个变量为常量后，再检验自变量与因变量的相关关系。
[^8]: [网络分析介绍(1)_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1NC4y1T7eW/)
[^9]: [心理学网络分析学习笔记【自用】_networkcomparisontest-CSDN博客](https://blog.csdn.net/qq_47316149/article/details/146902890)
[^10]: 😽[真的有写的这么详细的网络分析教程嘛？ - 知乎](https://zhuanlan.zhihu.com/p/20070286020)
[^11]: 所谓正则化，通俗点来讲就是通过引入一个惩罚项 (如 L1 范数或 L2 范数) 来限制模型复杂度，从而增强模型的泛化能力和稳定性。
[^12]: [网络分析笔记1_横断面网络分析_ebicglasso-CSDN博客](https://blog.csdn.net/2402_83812482/article/details/136985107)
[^13]: [网络分析(Network Analysis)入门篇(一) 网络节点的性质-CSDN博客](https://blog.csdn.net/limiyudianzi/article/details/81257762)
[^14]: [网络分析中的预期影响1-step和2-step - 知乎](https://zhuanlan.zhihu.com/p/27358711082)
[^15]: [三大统计相关系数：Pearson、Spearman秩相关系数、kendall等级相关系数_pearson相关系数-CSDN博客](https://blog.csdn.net/zhaozhn5/article/details/78392220)
[^16]: Zwicker, M. V., Nohlen, H. U., Dalege, J., Gruter, G.-J. M., & van Harreveld, F. (2020). Applying an attitude network approach to consumer behaviour towards plastic. _Journal of Environmental Psychology_, _69_, 101433. [https://doi.org/10.1016/j.jenvp.2020.101433](https://doi.org/10.1016/j.jenvp.2020.101433)
[^17]: 🐱[网络分析教程](https://rstudio-pubs-static.s3.amazonaws.com/1260794_9b847fb82fff4c21a8ae211f80029170.html)
[^18]: [基于R语言的Network analysis(网络分析) - 知乎](https://zhuanlan.zhihu.com/p/623536622)
[^19]: [R数据分析：网络分析的做法，原理和复现方法 - 知乎](https://zhuanlan.zhihu.com/p/581641222)
[^20]: [大学生人格特质和心理健康的网络分析研究](https://www.hanspub.org/journal/PaperInformation?paperID=64804)
[^21]: [如何在网络分析中计算可预测性(predictability) - 知乎](https://zhuanlan.zhihu.com/p/22574412387)
[^22]: 😽[网络分析第2部分_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1TP411A7aJ)
[^23]: [全教程：横断面网络分析中的网络比较 - 知乎](https://zhuanlan.zhihu.com/p/31179267448)
[^24]: [R软件 网络分析的实践操作(孙彬)_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1Rh4y1874q)
[^25]: Jones, P. J., Ma, R., & McNally, R. J. (2021). Bridge centrality: A network approach to understanding comorbidity. _Multivariate Behavioral Research_, _56_(2), 353–367. [https://doi.org/10.1080/00273171.2019.1614898](https://doi.org/10.1080/00273171.2019.1614898)
[^26]: [如何绘制桥接网络分析（bridge network analysis）图 - 知乎](https://zhuanlan.zhihu.com/p/22576002611)
[^27]: [桥接网络分析如何进行稳定性检验？ - 知乎](https://zhuanlan.zhihu.com/p/26849494046)
[^28]: [心理病理学的网络分析方法“大全” - 知乎](https://zhuanlan.zhihu.com/p/32422937981)